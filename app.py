import streamlit as st
import pandas as pd

# ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏á‡πà‡∏≤‡∏¢‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠
st.set_page_config(page_title="‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡∏ß‡∏±‡∏™‡∏î‡∏∏", layout="centered")

st.title("üèóÔ∏è ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ß‡∏±‡∏™‡∏î‡∏∏")

# 1. ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏Ç‡πâ‡∏≤‡∏°‡πÅ‡∏ñ‡∏ß‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÅ‡∏£‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô)
@st.cache_data
def load_data():
    file_name = "‡πÄ‡∏ó‡∏™‡∏ï‡∏≤‡∏£‡∏≤‡∏á.xlsx - data ‡∏´‡πâ‡∏≤‡∏°‡∏•‡∏ö ‡∏´‡πâ‡∏≤‡∏°‡∏ó‡∏≥‡∏ä‡∏µ‡∏ó‡∏ô‡∏µ‡πâ.csv"
    # ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÇ‡∏î‡∏¢‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà 1 (‡∏Ç‡πâ‡∏≤‡∏°‡πÅ‡∏ñ‡∏ß 0 ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ã‡πâ‡∏≠‡∏ô)
    df = pd.read_csv(file_name, skiprows=1)
    return df

try:
    df = load_data()
    
    # 2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô (‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÅ‡∏£‡∏Å)
    work_list = df.iloc[1:, 0].dropna().tolist() # ‡∏Ç‡πâ‡∏≤‡∏°‡πÅ‡∏ñ‡∏ß "‡∏≠‡∏±‡∏ï‡∏£‡∏≤/‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì"
    selected_work = st.selectbox("üìå ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á:", work_list)

    # 3. ‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏á‡∏≤‡∏ô
    quantity = st.number_input("üî¢ ‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏á‡∏≤‡∏ô (‡∏´‡∏ô‡πà‡∏ß‡∏¢):", min_value=0.0, step=1.0)

    if quantity > 0:
        st.divider()
        st.subheader("üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏™‡∏î‡∏∏")
        
        # ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏°‡∏≤‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì
        # ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏à‡∏∞‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Column ‡∏ó‡∏µ‡πà 2, 4, 6, 8, 10
        row_data = df[df.iloc[:, 0] == selected_work].iloc[0]
        
        # ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏™‡∏î‡∏∏ (‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏à‡∏£‡∏¥‡∏á)
        materials = ["‡∏´‡∏¥‡∏ô‡πÉ‡∏´‡∏ç‡πà", "‡∏´‡∏¥‡∏ô‡∏¢‡πà‡∏≠‡∏¢", "‡∏ó‡∏£‡∏≤‡∏¢‡∏´‡∏¢‡∏≤‡∏ö", "‡∏õ‡∏π‡∏ô‡∏ã‡∏µ‡πÄ‡∏°‡∏ô‡∏ï‡πå", "‡∏´‡∏¥‡∏ô‡∏Ñ‡∏•‡∏∏‡∏Å"]
        indices = [2, 4, 6, 8, 10] # ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå "‡∏≠‡∏±‡∏ï‡∏£‡∏≤" ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå CSV

        for mat, idx in zip(materials, indices):
            rate = row_data.iloc[idx]
            # ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            try:
                rate_val = float(rate)
                if rate_val > 0:
                    total = quantity * rate_val
                    st.success(f"**{mat}:** {total:,.2f} ‡∏´‡∏ô‡πà‡∏ß‡∏¢ (‡∏≠‡∏±‡∏ï‡∏£‡∏≤: {rate_val})")
            except:
                continue

except Exception as e:
    st.error(f"‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤: {e}")
    st.info("‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ô GitHub ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö '‡πÄ‡∏ó‡∏™‡∏ï‡∏≤‡∏£‡∏≤‡∏á.xlsx - data ‡∏´‡πâ‡∏≤‡∏°‡∏•‡∏ö ‡∏´‡πâ‡∏≤‡∏°‡∏ó‡∏≥‡∏ä‡∏µ‡∏ó‡∏ô‡∏µ‡πâ.csv'")
